(()=>{"use strict";var e={d:(t,i)=>{for(var n in i)e.o(i,n)&&!e.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:i[n]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};e.r(t),e.d(t,{PMPrinter:()=>l,createUid:()=>s,decoratePlayerNode:()=>o,loadScript:()=>r,normalizeDomReference:()=>a});const i={program_name:"EVMD",field_player_view_registration_key:"vm-pv-id",field_video_manager_decorator_class:"evm-player-label",field_rule_visibility_default_viewability_threshold:.9,field_wafer_attr_video_id:"data-video-id",field_wafer_attr_video_config:"data-video-config"};class n{constructor(e,t){this.name="Logger",this.enabled=!1,this.enabled=n.enabled(e),n.consoleOverrides.forEach((e=>{this[e]=this.enabled?console[e].bind(globalThis.console,i.program_name+(t?" "+t:"")):()=>{}}))}static enabled(e){const{debug:t}=this.retrieveDebugFlags(),i=this.flagSymbolAll,n=null==t?void 0:t.split(this.flagSymbolDelimiterPrimary),s=null==n?void 0:n.indexOf(i),r=this.flagSymbolDelimiterSecondary;let a=!1,o=t===i;-1!==s&&(o=!0,null==n||n.splice(s,1));let l=!1;if(n){for(let t of n){const n=e.includes(r)?e.split(r)[0]:null;t.charAt(0)===this.flagSymbolDeny&&(l=!0,t=t.substring(1));const s=t.includes(r)?t.split(r)[0]:null,o=t.includes(r)?t.split(r)[1]:null,d=n&&n===s,h=t.includes(e);if(a=t===e||!(!h&&!d)&&o===i,a)break}return a?l&&(a=!1):a=o,a}}static recordDebugFlags(){var e;if(!window)return;const t=new URLSearchParams(window.location.search);globalThis.localStorage.setItem(n.loggerKeyLocalStorage,JSON.stringify({debug:null!==(e=t.get(n.loggerKeyQuerystring))&&void 0!==e?e:""}))}static retrieveDebugFlags(){return JSON.parse(globalThis.localStorage.getItem(this.loggerKeyLocalStorage))}}n.consoleOverrides=["log","info","dir","error","debug"],n.loggerKeyLocalStorage="video-manager",n.loggerKeyQuerystring="vmd",n.flagSymbolAll="*",n.flagSymbolDelimiterPrimary=",",n.flagSymbolDelimiterSecondary=":",n.flagSymbolDeny="-",n.recordDebugFlags();const s=(e,t)=>{const i="abcdefghijklmnopqrstuvwxyz1234567890";return((e?e+"-":"")+[...Array(16)].map((()=>i[Math.floor(Math.random()*i.split("").length)])).join("")+(t?t+"-":"")).toUpperCase()},r=e=>new Promise((function(t,i){const n=document.createElement("script");n.type="text/javascript",n.src=e,n.onload=t,n.onerror=i,document.head.appendChild(n)})),a=function(e){let t=null;return e&&(t=e,"string"==typeof e&&(t=document.querySelectorAll(e)[0])),t},o=(e,t,n)=>{if(e){const s=globalThis.OATH.VideoPlatform.VideoManager.getInstance().getVMPlayerById(t).playerInstance,r=s.getPlaylistPosition()+1+"/"+s.getItems().length,a=e.getElementsByClassName(i.field_video_manager_decorator_class);a.length&&[...a].forEach((t=>{e.removeChild(t)}));const o=document.createElement("div");o.className=i.field_video_manager_decorator_class,o.style.cssText="\n            background-color: rgba(96, 2, 210, 0.25);\n            display: flex;\n            flex-direction: row;\n            justify-content: space-between;\n            position: absolute;\n            bottom: 0;\n            left: 0;\n            right: 0;\n            color: #fff;\n            font-family: monospace;\n            font-size: 0.6em;\n            z-index: 10;\n            padding: 0 0.25em;\n        ",e.insertBefore(o,e.firstChild);const l=document.createElement("div"),d=i.program_name+(t?":"+t:"");o.appendChild(l),l.appendChild(document.createTextNode(d));const h=document.createElement("div");if(o.appendChild(h),h.appendChild(document.createTextNode(r)),n){const e=document.createElement("div");o.appendChild(e),e.appendChild(document.createTextNode("UUID:"+n))}}};class l{constructor(e){if(this.darkMode=globalThis.matchMedia&&globalThis.matchMedia("(prefers-color-scheme: dark)").matches,this.logTag="PTR",this.logStyle="color:#"+(this.darkMode?"cecece":"666666")+";font-weight:500;",this.logStyleDim="color:#"+(this.darkMode?"666666":"cecece")+";font-weight:100;",this.playlistManager=null,this.playerInstance=null,!e)throw new Error("missing playlistManager");this.playlistManager=e,this.playerInstance=e.heroVMPlayer.playerInstance}timeDeadline(e){return new Date(e).toLocaleTimeString("en-US",{hour:"numeric",minute:"numeric",second:"numeric",hour12:!0})}timeUntil(e){return Math.floor(e/60)+"m:"+Math.floor(e%60)+"s"}print(e="",t=0,i,n){const s=[this.logTag+" "+(t?"  ":"").repeat(t)+"%c"+e,n||this.logStyle];i&&s.push(i),console.log(...s)}dim(e,t,i){this.print(e,t,i,this.logStyleDim)}stats(e=0){var t,i;const n=this.playlistManager,s=this.playerInstance,r=n.getMediaItems(),a=s.getItems(),o=[...document.getElementById("playlist-items").getElementsByTagName("li")],l=n.selectedItem,d=s.getCurrentItem(),h=r.findIndex((({id:e})=>e===(null==d?void 0:d.id))),u=s.getPlaylistPosition();let c=h+1;c>r.length-1&&(c=0),r[c];let v=u+1;v>=a.length-1&&(v=0);const f=a[v];this.dim("player: count:"+(null==a?void 0:a.length)+", position:"+u,e),this.dim("list counts: vp:"+(null==a?void 0:a.length)+", pm:"+r.length+", ui:"+o.length,e),this.dim("positions: pm: current:"+h+", next:"+c+"; vp: current:"+u+", next:"+v,e),this.dim("current: "+d.id,e),this.dim("title: '"+(null===(t=null==d?void 0:d.title)||void 0===t?void 0:t.substring(0,12))+"'",e+1),this.dim("duration: "+this.timeUntil(d.duration),e+1),this.dim("next: "+(null==f?void 0:f.id),e),this.dim("title: '"+(null===(i=null==f?void 0:f.title)||void 0===i?void 0:i.substring(0,12))+"'",e+1),this.dim("selected: "+(null==l?void 0:l.id),e)}lists(e){const t=this.playlistManager,i=this.playerInstance.getItems(),n=t.getMediaItems(),s={};n.forEach((t=>{var r,a;const o=t.id,l=null===(a=null===(r=n.find((({id:e})=>e===t.id)))||void 0===r?void 0:r.title)||void 0===a?void 0:a.substring(0,20),d=n.findIndex((({id:e})=>e===t.id)),h=i.findIndex((({id:e})=>e===t.id));s[o]={title:l,vp:h,pm:d},e&&o in s&&(s[o]=Object.assign(Object.assign({},s[o]),e[o]))})),console.table(s)}}var d,h=function(e,t,i,n){if("a"===i&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===i?n:"a"===i?n.call(e):n?n.value:t.get(e)};class u{constructor(){d.set(this,new n("pp"))}play(){var e,t,i;h(this,d,"f").debug(`${null==this?void 0:this.playerInstance.getCurrentItem().id} about to play`),(null===(e=null==this?void 0:this.playerInstance)||void 0===e?void 0:e.isPlaying())&&h(this,d,"f").debug(`${null==this?void 0:this.playerInstance.getCurrentItem().id} already playing`),null===(t=null==this?void 0:this.playerInstance)||void 0===t||t.play(),h(this,d,"f").debug(`${null==this?void 0:this.playerInstance.getCurrentItem().id} return from play() isPlaying:${null===(i=null==this?void 0:this.playerInstance)||void 0===i?void 0:i.isPlaying()}`)}pause(){var e;null===(e=null==this?void 0:this.playerInstance)||void 0===e||e.pause()}render(...e){var t;null===(t=null==this?void 0:this.playerInstance)||void 0===t||t.render(...e)}mute(){var e;return null===(e=null==this?void 0:this.playerInstance)||void 0===e?void 0:e.mute()}unMute(){var e;return null===(e=null==this?void 0:this.playerInstance)||void 0===e?void 0:e.unMute()}destroy(){var e;return null===(e=null==this?void 0:this.playerInstance)||void 0===e?void 0:e.destroy()}seek(){var e;return null===(e=null==this?void 0:this.playerInstance)||void 0===e?void 0:e.seek()}get playlist(){var e;return(null===(e=null==this?void 0:this.playerInstance)||void 0===e?void 0:e.playlist)||void 0}get version(){var e;return(null===(e=null==this?void 0:this.playerInstance)||void 0===e?void 0:e.version)||""}publish(...e){var t;return null===(t=null==this?void 0:this.playerInstance)||void 0===t?void 0:t.publish(...e)}on(...e){var t;return null===(t=null==this?void 0:this.playerInstance)||void 0===t?void 0:t.on(...e)}once(...e){var t;return null===(t=null==this?void 0:this.playerInstance)||void 0===t?void 0:t.once(...e)}addEventListener(...e){var t;return null===(t=null==this?void 0:this.playerInstance)||void 0===t?void 0:t.addEventListener(...e)}addEventListeners(...e){var t;return null===(t=null==this?void 0:this.playerInstance)||void 0===t?void 0:t.addEventListeners(...e)}removeEventListener(...e){var t;return null===(t=null==this?void 0:this.playerInstance)||void 0===t?void 0:t.removeEventListener(...e)}removeEventListeners(...e){var t;return null===(t=null==this?void 0:this.playerInstance)||void 0===t?void 0:t.removeEventListeners(...e)}getContinuousPlay(){var e;return null===(e=null==this?void 0:this.playerInstance)||void 0===e?void 0:e.getContinuousPlay()}getDuration(){var e;return null===(e=null==this?void 0:this.playerInstance)||void 0===e?void 0:e.getDuration()}getFullscreen(){var e;return null===(e=null==this?void 0:this.playerInstance)||void 0===e?void 0:e.getFullscreen()}getPlaybackRate(){var e;return null===(e=null==this?void 0:this.playerInstance)||void 0===e?void 0:e.getPlaybackRate()}getRootElement(){var e;return null===(e=null==this?void 0:this.playerInstance)||void 0===e?void 0:e.getRootElement()}getVideoElement(){var e;return null===(e=null==this?void 0:this.playerInstance)||void 0===e?void 0:e.getVideoElement()}getVolume(){var e;return null===(e=null==this?void 0:this.playerInstance)||void 0===e?void 0:e.getVolume()}setContinuousPlay(){var e;return null===(e=null==this?void 0:this.playerInstance)||void 0===e?void 0:e.setContinuousPlay()}setFullscreen(){var e;return null===(e=null==this?void 0:this.playerInstance)||void 0===e?void 0:e.setFullscreen()}setLoop(e){var t;return null===(t=null==this?void 0:this.playerInstance)||void 0===t?void 0:t.setLoop(e)}setPlaybackRate(e){var t;return null===(t=null==this?void 0:this.playerInstance)||void 0===t?void 0:t.setPlaybackRate(e)}setVolume(e){var t;return null===(t=null==this?void 0:this.playerInstance)||void 0===t?void 0:t.setVolume(e)}isDocked(){var e;return(null===(e=null==this?void 0:this.playerInstance)||void 0===e?void 0:e.isDocked())||!1}isLoading(){var e;return(null===(e=null==this?void 0:this.playerInstance)||void 0===e?void 0:e.isLoading())||!1}isMute(){var e;return(null===(e=null==this?void 0:this.playerInstance)||void 0===e?void 0:e.isMute())||!1}isPlaying(){var e;return(null===(e=null==this?void 0:this.playerInstance)||void 0===e?void 0:e.isPlaying())||!1}calculateViewability(){var e;return null===(e=null==this?void 0:this.playerInstance)||void 0===e?void 0:e.calculateViewability()}enableControls(){var e;return null===(e=null==this?void 0:this.playerInstance)||void 0===e?void 0:e.enableControls()}disableControls(){var e;return null===(e=null==this?void 0:this.playerInstance)||void 0===e?void 0:e.disableControls()}}d=new WeakMap;var c,v,f,m,g,y,p,w,b,P,I,E,M,T,C,S,L,V,_,$,x,k=function(e,t,i,n){return new(i||(i=Promise))((function(s,r){function a(e){try{l(n.next(e))}catch(e){r(e)}}function o(e){try{l(n.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?s(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(a,o)}l((n=n.apply(e,t||[])).next())}))},O=function(e,t,i,n,s){if("m"===n)throw new TypeError("Private method is not writable");if("a"===n&&!s)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===n?s.call(e,i):s?s.value=i:t.set(e,i),i},A=function(e,t,i,n){if("a"===i&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===i?n:"a"===i?n.call(e):n?n.value:t.get(e)};class R extends u{constructor(e,t){super(),c.add(this),this.id=s(),this.logger=null,this.isRendered=!1,this.isRendering=!1,f.set(this,null),m.set(this,null),g.set(this,null),this.playerInstance=null,w.set(this,!0),b.set(this,0),P.set(this,void 0),I.set(this,void 0),E.set(this,0);const{behavior:i=null,eagerlyLoadPlayerInstance:r=!0,serializeRender:o=!0,renderDelayMs:l=0,playDelayMs:d=400,managed:h=!0,rememberState:u=!1,domNode:v=null,repository:y=null}=t||{};this.logger=new n("pv",`VMPlayer[${this.id}]`),O(this,m,e,"f"),O(this,g,y,"f"),A(this,g,"f").registerView(this),O(this,f,i,"f"),A(this,f,"f").vmPlayer=this,r&&A(this,c,"m",S).call(this,e),O(this,w,o,"f"),l>0&&l<2e3&&O(this,b,l,"f"),d>0&&d<2e3&&O(this,E,d,"f"),O(this,P,a(v),"f"),A(this,P,"f")&&A(this,c,"m",M).call(this,A(this,P,"f")),this.logger.debug("created")}destroyPlayer(){var e;A(this,c,"m",C).call(this),null===(e=this.playerInstance)||void 0===e||e.destroy()}render(e){return k(this,void 0,void 0,(function*(){O(this,P,a(e)||this.getPlayerContainerDomNode(),"f"),this.isRendering||this.isRendered?this.logger.debug("render","already rendered or currently rendering"):A(this,w,"f")?(A(R,v,"f",y)._store.some((e=>e.id===this.id))?this.logger.info("render","already exists in render queue"):A(R,v,"f",y).push(this),A(R,v,"f",p)||A(R,v,"f",y).isEmpty()||(yield A(R,v,"m",_).call(R))):yield A(this,c,"m",L).call(this,A(this,P,"f"))}))}destroy(){this.destroyPlayer()}mute(e){super.mute()}pause(e){super.pause()}play(e){super.play()}getPlayerContainerDomNode(){return Array.from(document.querySelectorAll("["+i.field_player_view_registration_key+"]")).find((e=>e.getAttribute(i.field_player_view_registration_key)===this.id))}getPlayerConfig(){return A(this,m,"f")}getMediaItems(){if(this.playerInstance)return this.playerInstance.getItems()}setContentForOverlay(e){const t=document.createElement("div");for(t.innerHTML=e.trim(),t.style.cssText="\n            pointer-events: all;\n            z-index: 10;",void 0===A(this,I,"f")&&(O(this,I,document.createElement("div"),"f"),A(this,I,"f").style.cssText="\n                background-color: none;\n                opacity: 0.9;\n                position: absolute;\n                top: 0px;\n                aspect-ratio: 16/9;\n                width: 100%;\n                pointer-events: none;\n                z-index: 10;");A(this,I,"f").firstChild;)A(this,I,"f").removeChild(A(this,I,"f").firstChild);A(this,I,"f").appendChild(t)}getBehavior(){return A(this,f,"f")}}v=R,f=new WeakMap,m=new WeakMap,g=new WeakMap,w=new WeakMap,b=new WeakMap,P=new WeakMap,I=new WeakMap,E=new WeakMap,c=new WeakSet,M=function(e=null){return e&&e.setAttribute(i.field_player_view_registration_key,this.id),e},T=function(){this.getBehavior().bind(this.playerInstance,this.getPlayerContainerDomNode())},C=function(){A(this,f,"f").unbind()},S=function(e){O(this,m,e||A(this,m,"f"),"f");const t=A(this,c,"m",$).call(this);return t&&(this.playerInstance=new t(A(this,m,"f"))),this.playerInstance},L=function(e){return k(this,void 0,void 0,(function*(){this.logger.debug("renderImmediate(["+this.id+"])"),e?this.playerInstance?(A(this,c,"m",M).call(this,e),A(this,c,"m",x).call(this),this.isRendering=!0,yield A(this,c,"m",V).call(this,A(this,P,"f")),this.isRendering=!1,this.isRendered=!0,this.logger.debug("renderImmediate(["+this.id+"]) player.render done"),A(this,c,"m",T).call(this),A(this,I,"f")&&A(this,P,"f").appendChild(A(this,I,"f"))):this.logger.error("renderImmediate(["+this.id+"]) : no player instance!"):this.logger.error("renderImmediate(["+this.id+"]) failed : playerContainerReference undefined!")}))},V=function(...e){return k(this,void 0,void 0,(function*(){return new Promise(((t,i)=>{var n,s;const r=null===(s=null===(n=null===globalThis||void 0===globalThis?void 0:globalThis.YAHOO)||void 0===n?void 0:n.VideoPlatform)||void 0===s?void 0:s.Events,a=this.playerInstance.addEventListener(r.PLAYER_READY,(e=>{this.playerInstance.removeEventListener(r.PLAYER_READY,a),A(this,b,"f")?setTimeout((()=>{this.isRendering=!1,this.isRendered=!0,t()}),A(this,b,"f")):(this.isRendering=!1,this.isRendered=!0,t())}),{once:!0});A(this,c,"m",x).call(this),this.isRendering=!0,this.playerInstance.render(...e)}))}))},_=function e(){return k(this,void 0,void 0,(function*(){if(A(R,v,"f",y).isEmpty())O(R,v,!1,"f",p),console.debug("processRenderQueue() empty, processing completed");else{O(R,v,!0,"f",p);const t=A(R,v,"f",y).pop();A(t,P,"f")?(t.playerInstance?(t.logger.debug("processRenderQueue(["+t.id+"]) waiting..."),yield A(t,c,"m",V).call(t,A(t,P,"f")),A(t,I,"f")?A(t,P,"f").appendChild(A(t,I,"f")):t.logger.debug("processRenderQueue(["+t.id+"]) no domNode for overlay"),A(t,c,"m",T).call(t),t.logger.debug("processRenderQueue(["+t.id+"]) render done, processing again...")):t.logger.error("processRenderQueue(["+t.id+"]) : no player instance!"),yield A(R,v,"m",e).call(R)):(t.logger.error("processRenderQueue(["+t.id+"]) : playerContainerDomNode undefined!"),yield A(R,v,"m",e).call(R))}}))},$=function(){var e,t;let i;if(!(null===(t=null===(e=null===globalThis||void 0===globalThis?void 0:globalThis.YAHOO)||void 0===e?void 0:e.VideoPlatform)||void 0===t?void 0:t.VideoPlayer))throw Error("EVPlayer constructor missing");return i=globalThis.YAHOO.VideoPlatform.VideoPlayer,i},x=function(){this.logger.enabled&&o(A(this,P,"f"),this.id)},y={value:new class{constructor(){this._store=[]}push(e){this._store.push(e)}pop(){return this._store.shift()}isEmpty(){return this._store.length<=0}}},p={value:!1};var B,D,N,q,W,j,Y=function(e,t,i,n){return new(i||(i=Promise))((function(s,r){function a(e){try{l(n.next(e))}catch(e){r(e)}}function o(e){try{l(n.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?s(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(a,o)}l((n=n.apply(e,t||[])).next())}))},H=function(e,t,i,n,s){if("m"===n)throw new TypeError("Private method is not writable");if("a"===n&&!s)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===n?s.call(e,i):s?s.value=i:t.set(e,i),i},U=function(e,t,i,n){if("a"===i&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===i?n:"a"===i?n.call(e):n?n.value:t.get(e)},F=function(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,i=e[Symbol.asyncIterator];return i?i.call(e):(e="function"==typeof __values?__values(e):e[Symbol.iterator](),t={},n("next"),n("throw"),n("return"),t[Symbol.asyncIterator]=function(){return this},t);function n(i){t[i]=e[i]&&function(t){return new Promise((function(n,s){!function(e,t,i,n){Promise.resolve(n).then((function(t){e({value:t,done:i})}),t)}(n,s,(t=e[i](t)).done,t.value)}))}}};class G{constructor(e,t,i=!1){if(this.name="DefaultVideoManagerBehavior",B.set(this,null),D.set(this,void 0),N.set(this,void 0),q.set(this,!1),W.set(this,[]),j.set(this,new EventTarget),this.addUpdateEventListener=e=>{U(this,j,"f").addEventListener("update_done",e)},this.removeUpdateEventListener=e=>{U(this,j,"f").removeEventListener("update_done",e)},!e)throw Error("A VMPlayerRepository is required to create a VideoManagerBehavior");H(this,B,new n("vmb",this.name),"f"),H(this,D,e,"f"),H(this,N,t,"f")}updateState(){return Y(this,void 0,void 0,(function*(){U(this,B,"f").log("updateState() started..."),yield this.execute(),U(this,B,"f").log("updateState() finished");const e=new CustomEvent("update_done",{detail:{done:!0}});U(this,j,"f").dispatchEvent(e)}))}execute(){var e,t,i,n;return Y(this,void 0,void 0,(function*(){if(U(this,W,"f").push(U(this,W,"f").length),!U(this,q,"f")){for(H(this,q,!0,"f");U(this,W,"f").length;){U(this,B,"f").debug("execute() processing all VMPlayers begin");try{for(var s,r=!0,a=(t=void 0,F([...U(this,D,"f").getViews()]));s=yield a.next(),!(e=s.done);){n=s.value,r=!1;try{const[e,t]=n,i=t.playerInstance.getCurrentItem().id;U(this,B,"f").debug(`execute() vmPlayer[${e}] ${i} iterating behaviors begin`),yield t.getBehavior().execute(),U(this,B,"f").debug(`execute() vmPlayer[${e}] ${i} iterating behaviors end`)}finally{r=!0}}}catch(e){t={error:e}}finally{try{r||e||!(i=a.return)||(yield i.call(a))}finally{if(t)throw t.error}}U(this,B,"f").debug("execute() processing all VMPlayers end"),U(this,W,"f").shift()}H(this,q,!1,"f"),U(this,W,"f").length>0&&(U(this,W,"f").length=1,yield this.execute())}}))}requestPlay(e,t){if(U(this,B,"f").debug("requestPlay() "+e.id),t){U(this,B,"f").debug(`requestPlay() id:${e.id}, force-pausing other players`);for(const[t,i]of[...U(this,D,"f").getViews()])i!==e&&i.pause();return U(this,B,"f").debug(`requestPlay() isUserRequest for [${e.playerInstance.getCurrentItem().id}]  ${e.playerInstance.getCurrentItem().title} , waiting 400ms`),void e.play()}let i=!0;if(e.getBehavior().autoPlayEnabled)for(const[t,n]of U(this,D,"f").getViews())t!=e.id&&(n.playerInstance.isPlaying()?(i=!1,U(this,B,"f").debug("requestPlay() other video id: "+n.id+" is playing")):(U(this,B,"f").debug("requestPlay() would have paused "+n.id),n.pause()));else i=!1;U(this,B,"f").debug("requestPlay() requesting id: "+e.id+" shouldPlay: "+i),i&&e.play()}requestPause(e){U(this,B,"f").debug(`requestPause() vmPlayer[${e.id}] ${e.playerInstance.getCurrentItem().id}`),e.pause(),U(this,B,"f").debug("requestPause() executing all rules again"),this.execute()}}B=new WeakMap,D=new WeakMap,N=new WeakMap,q=new WeakMap,W=new WeakMap,j=new WeakMap;var K,Q=function(e,t,i,n){if("a"===i&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===i?n:"a"===i?n.call(e):n?n.value:t.get(e)};class z{constructor(e,t){this.logger=null,K.set(this,new Map),this.logger=new n("pvr",this.name),this.createDefaultVMPlayerBehavior=e}getVMPlayerById(e){return Q(this,K,"f").get(e)}getViews(){return Q(this,K,"f")}getViewIds(){return Object.keys(Object.fromEntries(Q(this,K,"f")))}registerView(e){Q(this,K,"f").has(e.id)||Q(this,K,"f").set(e.id,e)}unregisterView(e){Q(this,K,"f").delete(e.id)}}K=new WeakMap;var J=function(e,t,i,n){return new(i||(i=Promise))((function(s,r){function a(e){try{l(n.next(e))}catch(e){r(e)}}function o(e){try{l(n.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?s(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(a,o)}l((n=n.apply(e,t||[])).next())}))};class X{set autoPlayEnabled(e){var t;this._autoPlayEnabled=e,this.logger.debug(`autoPlayEnabled(${e}) for id: ${null===(t=this.vmPlayer)||void 0===t?void 0:t.id}`);const i=new CustomEvent("propChange",{detail:{name:"autoPlayEnabled",enabled:this._autoPlayEnabled}});this.propChangeEventTarget.dispatchEvent(i),this.updateState()}get autoPlayEnabled(){return this._autoPlayEnabled}constructor(e,t){this.id=s(),this.name="BaseVMPlayerBehavior",this.rules=[],this.playerInstance=null,this.playerContainerDomNode=null,this.propChangeEventTarget=new EventTarget,this._autoPlayEnabled=!0,this.addPropChangeEventListener=e=>{this.propChangeEventTarget.addEventListener("propChange",e)},this.removePropChangeEventListener=e=>{this.propChangeEventTarget.removeEventListener("propChange",e)};const{debug:i=!1}=t||{};if(!e)throw Error("A VideoManagerBehavior is required to construct a VMPlayerBehavior");this.logger=new n("pvb",`${this.name}[${this.id}]`),this.parentBehavior=e}bind(e,t){if(this.playerInstance=e||this.playerInstance,this.playerContainerDomNode=t||this.playerContainerDomNode,!this.playerInstance)throw Error("VMPlayerBehavior.bind() A player instance is required to bind a behavior");this.rules.forEach((e=>{e.startObserving(this.playerContainerDomNode)}))}unbind(){this.rules.forEach((e=>{e.stopObserving()})),this.playerContainerDomNode=null,this.playerInstance=null}updateState(){var e;this.logger.debug(`updateState() id: ${null===(e=this.vmPlayer)||void 0===e?void 0:e.id}`),this.vmPlayer?this.vmPlayer.isRendered?this.parentBehavior.updateState():this.logger.debug("updateState() ignored,  player not rendered yet"):this.logger.debug("updateState() ignored, no player")}execute(){return J(this,void 0,void 0,(function*(){yield Promise.all(this.rules.map(((e,t)=>J(this,void 0,void 0,(function*(){this.logger.debug(`execute() rule: ${e.name} index: ${t}`),yield e._execute()})))))}))}requestAutoPlay(){var e,t,i,n,s,r;this.logger.debug(`requestAutoPlay() id: ${null===(e=this.vmPlayer)||void 0===e?void 0:e.id}`),(null===(t=this.vmPlayer)||void 0===t?void 0:t.isRendered)?this.rules.some((e=>(e.allowPlayback||this.logger.debug(`requestAutoPlay(): rule ${e.name} denied playback`),!e.allowPlayback)))?this.logger.debug(`requestAutoPlay() denied for id: ${null===(r=this.vmPlayer)||void 0===r?void 0:r.id}`):this.vmPlayer&&this.autoPlayEnabled?(this.logger.debug(`requestAutoPlay() autoPlayEnabled so requesting play, id: ${null===(n=this.vmPlayer)||void 0===n?void 0:n.id}`),this.parentBehavior.requestPlay(this.vmPlayer)):this.logger.debug(`requestAutoPlay() ignored, id: ${null===(s=this.vmPlayer)||void 0===s?void 0:s.id} autoPlayEnabled: ${this.autoPlayEnabled}`):this.logger.error(`requestAutoPlay(): id: ${null===(i=this.vmPlayer)||void 0===i?void 0:i.id} failed, player not rendered yet`)}requestPause(){var e;this.logger.debug(`requestPause() id: ${null===(e=this.vmPlayer)||void 0===e?void 0:e.id}`),this.vmPlayer&&this.parentBehavior.requestPause(this.vmPlayer)}userRequestPlay(){var e,t;(null===(e=this.vmPlayer)||void 0===e?void 0:e.isRendered)?this.vmPlayer?this.rules.some((e=>(e.allowPlayback||this.logger.debug(`userRequestPlay() rule ${e.name} denied playback`),!e.allowPlayback)))||this.parentBehavior.requestPlay(this.vmPlayer,!0):this.logger.error("userRequestPlay() failed, no player"):this.logger.error(`userRequestPlay() id: ${null===(t=this.vmPlayer)||void 0===t?void 0:t.id} failed, player not rendered yet`)}}class Z{constructor(e){if(this.id=s(),this.name="BaseRule",this.allowPlayback=!0,this.startObserving=e=>{this.logger.debug(`${this.name} startObserving()`)},this.stopObserving=()=>{this.logger.debug(`${this.name} stopObserving()`)},this.execute=()=>{this.logger.debug(`${this.name} execute()`)},!e)throw Error("A behavior is required to setup a rule!");this.behavior=e,this.logger=new n("r:base",`${this.name}[${this.id}]`)}_execute(){return e=this,t=void 0,n=function*(){return new Promise(((e,t)=>{this.logger.debug(`${this.name} execute()`),this.execute(),e()}))},new((i=void 0)||(i=Promise))((function(s,r){function a(e){try{l(n.next(e))}catch(e){r(e)}}function o(e){try{l(n.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?s(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(a,o)}l((n=n.apply(e,t||[])).next())}));var e,t,i,n}}var ee,te,ie,ne,se,re,ae,oe,le=function(e,t,i,n){return new(i||(i=Promise))((function(s,r){function a(e){try{l(n.next(e))}catch(e){r(e)}}function o(e){try{l(n.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?s(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(a,o)}l((n=n.apply(e,t||[])).next())}))},de=function(e,t,i,n,s){if("m"===n)throw new TypeError("Private method is not writable");if("a"===n&&!s)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===n?s.call(e,i):s?s.value=i:t.set(e,i),i},he=function(e,t,i,n){if("a"===i&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===i?n:"a"===i?n.call(e):n?n.value:t.get(e)};class ue extends Z{constructor(e,t){super(e),ee.add(this),this.id=s(),this.name="VisibilityRule",te.set(this,void 0),ie.set(this,null),ne.set(this,!1),se.set(this,0),re.set(this,void 0),this.behavior=null,this.allowPlayback=!1,this.startObserving=e=>{if(de(this,re,e||he(this,re,"f"),"f"),!he(this,re,"f"))throw Error("HTMLElement is required to start observing");he(this,ie,"f")?he(this,te,"f").error("startObserving, already observing"):he(this,ne,"f")?he(this,te,"f").info("startObserving ignored, disableIntersectionObserver: "+he(this,ne,"f")):(he(this,te,"f").debug(`startObserving ${he(this,re,"f").id}}`),de(this,ie,new IntersectionObserver(he(this,ee,"m",oe).bind(this),{root:null,rootMargin:"0px",threshold:he(this,se,"f")}),"f"),he(this,ie,"f").observe(he(this,re,"f")))},this.stopObserving=()=>{he(this,ie,"f")&&he(this,ie,"f").unobserve(he(this,re,"f")),de(this,re,null,"f")};const{debug:r=!1,disableVisObserver:a=!1,visibilityThreshold:o=i.field_rule_visibility_default_viewability_threshold}=t||{};de(this,se,o,"f"),this.behavior=e,de(this,ne,a,"f"),de(this,te,new n("r:v",`${this.name}[${this.id}]`),"f")}_execute(){return le(this,void 0,void 0,(function*(){he(this,te,"f").debug("execute()");const e=yield this.isElementVisibleInViewportAsync(he(this,re,"f"));he(this,ee,"m",ae).call(this,e)}))}isElementVisibleInViewportAsync(e){var t;return le(this,void 0,void 0,(function*(){if(!e)return!1;const i=null===(t=this.behavior.vmPlayer)||void 0===t?void 0:t.playerInstance;return!(!i||!(yield i.getFullscreen()))||(yield new Promise((t=>{const i=new IntersectionObserver((([{isIntersecting:n}])=>{t(n),i.unobserve(e)}),{root:null,rootMargin:"0px",threshold:he(this,se,"f")});i.observe(e)})))}))}}te=new WeakMap,ie=new WeakMap,ne=new WeakMap,se=new WeakMap,re=new WeakMap,ee=new WeakSet,ae=function(e){var t;const i=this.behavior.vmPlayer.id;he(this,te,"f").info(`handleVisible() [${i}]: `,e?"visible":"hidden"),e?this.behavior.autoPlayEnabled?(he(this,te,"f").debug(`handleVisible() [${i}]: in viewport and allowPlayback true so requesting play`),this.allowPlayback=!0,this.behavior.requestAutoPlay()):he(this,te,"f").info(`handleVisible() [${i}]: autoplay disabled`):(this.allowPlayback=!1,(null===(t=this.behavior.vmPlayer)||void 0===t?void 0:t.playerInstance.isPlaying())&&(he(this,te,"f").debug(`handleVisible() [${i}] not in viewport so requesting pause`),this.behavior.requestPause()))},oe=function(e){e.forEach((e=>le(this,void 0,void 0,(function*(){var t,i,n,s;he(this,te,"f").log("handler() target: "+e.target.getAttribute("vm-pv-id")," isIntersecting: "+e.isIntersecting);const r=null===(t=this.behavior.vmPlayer)||void 0===t?void 0:t.playerInstance.getCurrentItem().title;e.isIntersecting?this.allowPlayback=!0:(he(this,te,"f").info("not intersecting so disallowing playback, id: "+(null===(i=this.behavior.vmPlayer)||void 0===i?void 0:i.id)+" title: "+r),this.allowPlayback=!1),he(this,te,"f").info(`${this.name} handleIntersectionObserver() calling VMPlayerBehavior.updateState(): vmPlayerId: ${null===(n=this.behavior.vmPlayer)||void 0===n?void 0:n.id} uuid: ${null===(s=this.behavior.vmPlayer)||void 0===s?void 0:s.playerInstance.getCurrentItem().id} title: ${r}`),this.behavior.updateState()}))))};var ce,ve,fe=function(e,t,i,n,s){if("m"===n)throw new TypeError("Private method is not writable");if("a"===n&&!s)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===n?s.call(e,i):s?s.value=i:t.set(e,i),i},me=function(e,t,i,n){if("a"===i&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===i?n:"a"===i?n.call(e):n?n.value:t.get(e)};class ge extends Z{constructor(e,t){super(e),this.id=s(),this.name="UserPlayPauseRule",ce.set(this,void 0),this.allowPlayback=!0,ve.set(this,void 0),this.startObserving=e=>{var t,i,n;const s=null===(i=null===(t=null===window||void 0===window?void 0:window.YAHOO)||void 0===t?void 0:t.VideoPlatform)||void 0===i?void 0:i.Events;fe(this,ve,null===(n=this.behavior.vmPlayer)||void 0===n?void 0:n.playerInstance.addEventListener(s.UI_INTERACT,(e=>{me(this,ce,"f").log("UserPlayPauseRule element: ",e.element);let t=!1;"ctrl-play-btn"===e.element?(this.behavior.autoPlayEnabled=!0,t=!0):"ctrl-pause-btn"===e.element?this.behavior.autoPlayEnabled=!1:"video-click"===e.element?this.behavior.vmPlayer.playerInstance.isPlaying()?this.behavior.autoPlayEnabled=!1:(this.behavior.autoPlayEnabled=!0,t=!0):"startScreen"===e.element&&(this.behavior.autoPlayEnabled=!0,t=!0),t&&this.behavior.userRequestPlay()})),"f")},this.stopObserving=()=>{var e,t;removeEventListener(null===(t=null===(e=null===window||void 0===window?void 0:window.YAHOO)||void 0===e?void 0:e.VideoPlatform)||void 0===t?void 0:t.Events,me(this,ve,"f"))};const{debug:i}=t;this.behavior=e,fe(this,ce,new n("r:upp",`${this.name}[${this.id}]`),"f")}_execute(){return e=this,t=void 0,n=function*(){return me(this,ce,"f").debug("execute() nothing to do"),Promise.resolve()},new((i=void 0)||(i=Promise))((function(s,r){function a(e){try{l(n.next(e))}catch(e){r(e)}}function o(e){try{l(n.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?s(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(a,o)}l((n=n.apply(e,t||[])).next())}));var e,t,i,n}}ce=new WeakMap,ve=new WeakMap;class ye extends X{constructor(e,t){super(e,{debug:null==t?void 0:t.debug}),this.id=s(),this.name="DefaultVMPlayerBehavior";const{debug:r=!1,disableVisObserver:a=!1,visibilityThreshold:o=i.field_rule_visibility_default_viewability_threshold}=t||{};if(!e)throw Error("A VideoManagerBehavior is required to construct a VMPlayerBehavior");this.logger=new n("pvb",`${this.name}[${this.id}]`),this.parentBehavior=e,this.logger.debug("created VMPlayerBehavior, disableVisibilityDomObserver: "+a);const l={disableVisObserver:a,visibilityThreshold:o};this.rules.push(new ue(this,l)),this.rules.push(new ge(this,l))}static createInstance(e,t){return new ye(e,t)}}var pe,we,be=function(e,t,i,n,s){if("m"===n)throw new TypeError("Private method is not writable");if("a"===n&&!s)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===n?s.call(e,i):s?s.value=i:t.set(e,i),i},Pe=function(e,t,i,n){if("a"===i&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===i?n:"a"===i?n.call(e):n?n.value:t.get(e)};class Ie{constructor(e){this.id=s(),this.logger=new n("vm"),pe.set(this,void 0),we.set(this,void 0);const{vmPlayerBehaviorCreator:t,behavior:i}=e||{};be(this,we,new z(t||ye.createInstance),"f"),be(this,pe,i||new G(Pe(this,we,"f")),"f")}createVMPlayer(e,t){return t.repository=this.getVMPlayerRepository(),t.behavior||(t.behavior=t.repository.createDefaultVMPlayerBehavior(Pe(this,pe,"f"),{disableVisObserver:t.disableVisObserver||!1,visibilityThreshold:t.visibilityThreshold||i.field_rule_visibility_default_viewability_threshold,videoManagerBehavior:Pe(this,pe,"f")})),new R(e,t)}createPlayerView(e,t){return this.createVMPlayer(e,t)}getVMPlayers(){return this.getVMPlayerRepository().getViews()}getVMPlayerIds(){return this.getVMPlayerRepository().getViewIds().join()}getVMPlayerById(e){return this.getVMPlayerRepository().getVMPlayerById(e)}getPlayerContainerDomNode(e){return e.getPlayerContainerDomNode()}getVMPlayerForDomNode(e){const t=this.getVMPlayers();for(const[,i]of t)if(i.getPlayerContainerDomNode()==e)return i;return null}isDomNodeRegistered(e){let t=!1;if("string"==typeof e&&(e=document.getElementById(e)),e){const n=e.getAttribute(i.field_player_view_registration_key),s=this.getVMPlayers();for(const[,e]of s)e.id===n&&(t=!0)}return t}getVMPlayerBehavior(e){return this.getVMPlayerRepository().getVMPlayerById(e).getBehavior()}getBehavior(){return Pe(this,pe,"f")}getVMPlayerRepository(){return Pe(this,we,"f")}updateState(){Pe(this,pe,"f").execute()}}pe=new WeakMap,we=new WeakMap;const Ee=function(){let e;return{version:"2.0.14",logger:new n("st"),getInstance:function(t){return e||(e=new Ie(t)),e}}}();class Me{constructor(e){const{videoId:t,thumbnail:i,title:n="no title",description:s="no description",startTime:r=0,endTime:a=0}=e;if(this.videoId=t,this.title=n,this.thumbnail=i||void 0,this.description=s,this.startTime=r,this.endTime=a,this.startTime>=this.endTime)throw new Error("startTime must be less than endTime")}get duration(){const e=this.endTime-this.startTime;return e>0?e:0}}var Te,Ce,Se,Le,Ve,_e,$e,xe,ke,Oe,Ae,Re,Be,De,Ne,qe,We,je=function(e,t,i,n){return new(i||(i=Promise))((function(s,r){function a(e){try{l(n.next(e))}catch(e){r(e)}}function o(e){try{l(n.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?s(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(a,o)}l((n=n.apply(e,t||[])).next())}))},Ye=function(e,t,i,n,s){if("m"===n)throw new TypeError("Private method is not writable");if("a"===n&&!s)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===n?s.call(e,i):s?s.value=i:t.set(e,i),i},He=function(e,t,i,n){if("a"===i&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===i?n:"a"===i?n.call(e):n?n.value:t.get(e)};!function(e){e.Linear="Linear",e.Circular="Circular"}(qe||(qe={})),function(e){e.MediaItemsChanged="MediaItemsChanged",e.SelectedItemChanged="SelectedItemChanged"}(We||(We={}));Ce=new WeakMap,Se=new WeakMap,Le=new WeakMap,Ve=new WeakMap,_e=new WeakMap,$e=new WeakMap,xe=new WeakMap,ke=new WeakMap,Te=new WeakSet,Oe=function(e){He(this,Ce,"f").enabled&&o(He(this,$e,"f").getPlayerContainerDomNode(),He(this,$e,"f").id,e)},Ae=function(e){const t=He(this,Se,"f").find((t=>t.id===e.item.id));He(this,Ce,"f").debug("handleItemStart","item "+(null==t?void 0:t.id)),t||(He(this,Ce,"f").info(`player is playing a non-managed item ${e.item.id}`),this.selectItem(null)),He(this,Te,"m",Oe).call(this,t.id)},Re=function(e){const t=He(this,Se,"f").find((t=>t.id===e.item.id));He(this,Ce,"f").debug("handleItemEnd","item "+(null==t?void 0:t.id)),t?this.enableAutoAdvance?this.playNextItem():He(this,Ce,"f").info(`on ITEM_END ignoring playNextItem(), enableAutoAdvance is ${this.enableAutoAdvance}`):He(this,Ce,"f").info(`ignoring playNextItem() as player was playing a non-managed item ${e.item.id}`)},Be=function(e){const t=He(this,Se,"f").find((t=>t.id===e.item.id));if(He(this,Ce,"f").debug("handlePlaylistPositionChange","changedItem "+(null==t?void 0:t.id)),t){const e=He(this,Se,"f").findIndex((e=>e.id===t.id));this.selectItem(He(this,Se,"f")[e],!1)}else He(this,Ce,"f").info(`ignoring playNextItem() as player was playing a non-managed item ${e.item.id}`)},De=function(){var e;const t=globalThis.OATH.VideoPlatform.Events,i=null===(e=He(this,$e,"f"))||void 0===e?void 0:e.playerInstance;i?(He(this,xe,"f")[t.ITEM_START]=i.addEventListener(t.ITEM_START,He(this,Te,"m",Ae).bind(this)),He(this,xe,"f")[t.ITEM_END]=i.addEventListener(t.ITEM_END,He(this,Te,"m",Re).bind(this)),He(this,xe,"f")[t.PLAYLIST_POSITION_CHANGE]=i.addEventListener(t.PLAYLIST_POSITION_CHANGE,He(this,Te,"m",Be).bind(this))):He(this,Ce,"f").debug("registerPlayerEvents: missing player instance")},Ne=function(){var e;const t=globalThis.OATH.VideoPlatform.Events,i=null===(e=He(this,$e,"f"))||void 0===e?void 0:e.playerInstance;i?(i.removeEventListener(t.ITEM_START,He(this,xe,"f")[t.ITEM_START]),delete He(this,xe,"f")[t.ITEM_START],i.removeEventListener(t.ITEM_END,He(this,xe,"f")[t.ITEM_END]),delete He(this,xe,"f")[t.ITEM_END],i.removeEventListener(t.PLAYLIST_POSITION_CHANGE,He(this,xe,"f")[t.PLAYLIST_POSITION_CHANGE]),delete He(this,xe,"f")[t.PLAYLIST_POSITION_CHANGE]):He(this,Ce,"f").debug("unregisterPlayerEvents: missing player instance")};var Ue,Fe,Ge,Ke,Qe,ze,Je,Xe,Ze=function(e,t,i,n,s){if("m"===n)throw new TypeError("Private method is not writable");if("a"===n&&!s)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===n?s.call(e,i):s?s.value=i:t.set(e,i),i},et=function(e,t,i,n){if("a"===i&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===i?n:"a"===i?n.call(e):n?n.value:t.get(e)};!function(e){e.SelectedItemChanged="SelectedItemChanged"}(Xe||(Xe={}));class tt{constructor(e){Ue.add(this),Fe.set(this,new n("segmentsList")),Ge.set(this,void 0),Ke.set(this,[]),Qe.set(this,void 0),ze.set(this,new EventTarget),this.addEventListener=(e,t)=>{e===Xe.SelectedItemChanged&&et(this,ze,"f").addEventListener(Xe.SelectedItemChanged,t)},this.removeEventListener=(e,t)=>{e===Xe.SelectedItemChanged&&et(this,ze,"f").removeEventListener(Xe.SelectedItemChanged,t)};const{parentUuid:t}=e||{};Ze(this,Ge,t,"f")}set parentUuid(e){Ze(this,Ge,e,"f")}get parentUuid(){return`${et(this,Ge,"f")}`}setItems(e){Ze(this,Ke,[],"f"),e.forEach((e=>{et(this,Ke,"f").push(Object.assign({},e))}))}getItems(){const e=[];return et(this,Ke,"f").forEach((t=>{e.push(Object.assign({},t))})),e}getItemAtTime(e){for(let t=et(this,Ke,"f").length-1;t>=0;t--)if(et(this,Ke,"f")[t].startTime<=e&&et(this,Ke,"f")[t].endTime>=e)return et(this,Ke,"f")[t];return null}getSelected(){return et(this,Qe,"f")?Object.assign({},et(this,Qe,"f")):null}select(e,t=!0){if(null==e)return Ze(this,Qe,null,"f"),void(t&&et(this,Ue,"m",Je).call(this));const i=et(this,Ke,"f").find((t=>t.startTime===e.startTime));i?(!et(this,Qe,"f")||et(this,Qe,"f")&&et(this,Qe,"f").startTime!=i.startTime)&&(Ze(this,Qe,Object.assign({},i),"f"),t&&et(this,Ue,"m",Je).call(this)):et(this,Fe,"f").error("selectedPos: segment not found")}selectAtTime(e){const t=et(this,Ke,"f").find((t=>t.startTime<=e&&t.endTime>=e));t?(Ze(this,Qe,Object.assign({},t),"f"),et(this,Ue,"m",Je).call(this)):et(this,Fe,"f").error(`selectedPos: no segment found at time ${e}`)}selectAt(e){const t=et(this,Ke,"f")[e];t?(Ze(this,Qe,t,"f"),et(this,Ue,"m",Je).call(this)):et(this,Fe,"f").error(`selectedPos: no segment found at index ${e}`)}}Fe=new WeakMap,Ge=new WeakMap,Ke=new WeakMap,Qe=new WeakMap,ze=new WeakMap,Ue=new WeakSet,Je=function(){var e;const t=(null===(e=et(this,Qe,"f"))||void 0===e?void 0:e.startTime)||-1,i=et(this,Ke,"f").findIndex((e=>e.startTime==t));let n=null;-1!=i?et(this,Qe,"f"):et(this,Fe,"f").error("fireSelectionChange: selected item index not found in segmentList");const s=new CustomEvent(Xe.SelectedItemChanged,{detail:{item:et(this,Qe,"f"),startTime:t,index:i,extras:{}}});et(this,Fe,"f").debug(`fireSelectionChange: selectionChangedEvent index= ${s.detail.index}`),et(this,ze,"f").dispatchEvent(s)};var it,nt,st,rt,at,ot,lt=function(e,t,i,n){if("a"===i&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===i?n:"a"===i?n.call(e):n?n.value:t.get(e)},dt=function(e,t,i,n,s){if("m"===n)throw new TypeError("Private method is not writable");if("a"===n&&!s)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===n?s.call(e,i):s?s.value=i:t.set(e,i),i};class ht{constructor(){it.add(this),this.id=s(),nt.set(this,"SegmentSyncer"),st.set(this,void 0),rt.set(this,void 0),dt(this,st,new n("r:segsync",`${lt(this,nt,"f")}[${this.id}]`),"f")}setVMPlayer(e){var t,i,n;this.vmPlayer&&(null===(t=this.vmPlayer)||void 0===t||t.playerInstance.removeEventListener(null===(n=null===(i=null===window||void 0===window?void 0:window.YAHOO)||void 0===i?void 0:i.VideoPlatform)||void 0===n?void 0:n.Events.PLAYBACK_PROGRESS,lt(this,rt,"f")),dt(this,rt,null,"f")),this.vmPlayer=e,this.vmPlayer}setSegmentList(e){var t,i,n;if(this.currentSegmentList&&this.currentSegmentList.removeEventListener(Xe.SelectedItemChanged,lt(this,it,"m",ot)),this.currentSegmentList=e,this.currentSegmentList&&this.currentSegmentList.getItems().length>0){this.currentSegmentList.addEventListener(Xe.SelectedItemChanged,lt(this,it,"m",ot).bind(this));const e=this.currentSegmentList.getSelected();if(e){const t=this.currentSegmentList.getItems().findIndex((t=>t.startTime==e.startTime));lt(this,it,"m",ot).call(this,{detail:{item:{startTime:e.startTime,index:t}}})}lt(this,it,"m",at).call(this)}else null===(t=this.vmPlayer)||void 0===t||t.playerInstance.removeEventListener(null===(n=null===(i=null===window||void 0===window?void 0:window.YAHOO)||void 0===i?void 0:i.VideoPlatform)||void 0===n?void 0:n.Events.PLAYBACK_PROGRESS,lt(this,rt,"f")),dt(this,rt,null,"f")}seekToSegment(e){return t=this,i=void 0,s=function*(){const t=yield this.vmPlayer.playerInstance.getCurrentTime();e.startTime<=t&&t<=e.endTime?lt(this,st,"f").debug(`seekToSegment: current time ${t} is already during this Segment's timeframe [${e.description} ${e.startTime} to ${e.endTime}]`):this.vmPlayer.playerInstance.seek(e.startTime)},new((n=void 0)||(n=Promise))((function(e,r){function a(e){try{l(s.next(e))}catch(e){r(e)}}function o(e){try{l(s.throw(e))}catch(e){r(e)}}function l(t){var i;t.done?e(t.value):(i=t.value,i instanceof n?i:new n((function(e){e(i)}))).then(a,o)}l((s=s.apply(t,i||[])).next())}));var t,i,n,s}}nt=new WeakMap,st=new WeakMap,rt=new WeakMap,it=new WeakSet,at=function(){var e,t,i;const n=null===(t=null===(e=null===window||void 0===window?void 0:window.YAHOO)||void 0===e?void 0:e.VideoPlatform)||void 0===t?void 0:t.Events;dt(this,rt,null===(i=this.vmPlayer)||void 0===i?void 0:i.playerInstance.addEventListener(n.PLAYBACK_PROGRESS,(e=>{var t,i,n,s,r;const a=e.item.currentTime;if(null==a||null==a)return void lt(this,st,"f").error("progressListener PLAYBACK_PROGRESS: currentTime is missing");const o=null===(t=this.currentSegmentList)||void 0===t?void 0:t.getSelected();if(o&&o.startTime<=a&&a<=(null==o?void 0:o.endTime))lt(this,st,"f").debug(`progressListener: current time ${a} is during existing selected Segment's timeframe [${o.description} ${o.startTime} to ${o.endTime}]`);else{const e=null===(i=this.currentSegmentList)||void 0===i?void 0:i.getItemAtTime(a);e?(-1!=((null==o?void 0:o.startTime)||-1)&&lt(this,st,"f").debug("progressListener: not gonna fire select event"),lt(this,st,"f").debug(`progressListener: selecting Segment ${e.description} containing ${a}`),null===(n=this.currentSegmentList)||void 0===n||n.select(e)):(lt(this,st,"f").debug(`progressListener: no Segment found containing ${a}`),null!=(null===(s=this.currentSegmentList)||void 0===s?void 0:s.getSelected())&&(null===(r=this.currentSegmentList)||void 0===r||r.select(null)))}})),"f")},ot=function(e){lt(this,st,"f").debug("handleSelectionChange"),null!=e.detail.item?(lt(this,st,"f").debug(`handleSelectionChange: ${e.detail.item.startTime} index: ${e.detail.index}`),this.vmPlayer?this.vmPlayer.playerInstance.getCurrentTime()<e.detail.item.startTime&&(lt(this,st,"f").debug(`navigating to Segment at ${e.detail.item.startTime}`),this.vmPlayer.playerInstance.seek(e.detail.item.startTime)):lt(this,st,"f").info("handleSelectionChange: no vmPlayer to navigate")):lt(this,st,"f").debug("handleSelectionChange no item selected")},void 0!==typeof window&&(Ee.PlayerConfig=class{constructor(e){this.items=[],this.site="vidman",this.region="US",this.lang="en-US";const{mediaItems:t}=e;this.items=t}},Ee.MediaItem=class{constructor(e){const{id:t,thumbnail:i,title:n="no title",description:s="no description",duration:r=0,segments:a=null}=e;this.id=t,this.title=n,this.thumbnail=i,this.description=s,this.duration=r,this.segments=a}},Ee.constants=i,Ee.utilities=t,Ee.Logger=n,Ee.BaseVMPlayerBehavior=X,Ee.BaseRule=Z,Ee.UserPlayPauseRule=ge,Ee.VisibilityRule=ue,Ee.PlaylistManager=class{constructor(e){Te.add(this),this.id=s(),this.enableAutoAdvance=!0,Ce.set(this,new n("playlistmgr")),Se.set(this,[]),Le.set(this,void 0),Ve.set(this,qe.Circular),_e.set(this,new EventTarget),$e.set(this,void 0),this.circularListLength=4,xe.set(this,{}),ke.set(this,!0),this.addEventListener=(e,t)=>{He(this,_e,"f").addEventListener(e,t)},this.removeEventListener=(e,t)=>{He(this,_e,"f").removeEventListener(e,t)};const{mediaItems:t=[],behavior:i=qe.Circular,circularListLength:r,heroVMPlayer:a}=e||{};Ye(this,$e,a,"f"),t.forEach((e=>{He(this,Se,"f").push(Object.assign({},e))})),Ye(this,Ve,i,"f"),this.circularListLength=r>0?r:t.length}set heroVMPlayer(e){if(void 0!==e){if(void 0!==He(this,$e,"f"))throw new Error("heroVMPlayer already set");if(!e.isRendered)throw new Error("set heroVMPlayer failed, vmPlayer isn't rendered");Ye(this,$e,e,"f"),Ye(this,xe,{},"f"),He(this,Te,"m",De).call(this)}}get heroVMPlayer(){return He(this,$e,"f")}set heroPlayerView(e){Ye(this,$e,e,"f")}get heroPlayerView(){return He(this,$e,"f")}set behavior(e){Ye(this,Ve,e,"f")}get behavior(){return He(this,Ve,"f")}setMediaItems(e){var t,i,n,s,r;return je(this,void 0,void 0,(function*(){if(He(this,Se,"f").length=0,e.forEach((e=>{He(this,Se,"f").push(Object.assign({},e))})),null===(t=He(this,$e,"f"))||void 0===t?void 0:t.playerInstance){if((null===(i=He(this,$e,"f"))||void 0===i?void 0:i.playerInstance.getItems().length)<=0){He(this,Ce,"f").info("setMediaItems: player items empty, loading iteratively");let t=0;e.forEach((e=>je(this,void 0,void 0,(function*(){const i={id:e.id};t=yield He(this,$e,"f").playerInstance.addPlaylistItem(i),He(this,Ce,"f").debug(`setMediaItems: added ${i.id} at pos: ${t}`)}))))}He(this,Ce,"f").debug(`setMediaItems: playerlist.length ${null===(n=He(this,$e,"f"))||void 0===n?void 0:n.playerInstance.getItems().length} and mediaItems.length = ${He(this,Se,"f").length}`),(null===(s=He(this,$e,"f"))||void 0===s?void 0:s.playerInstance.getItems().length)!==He(this,Se,"f").length&&He(this,Ce,"f").error(`setMediaItems: playerlist.length ${null===(r=He(this,$e,"f"))||void 0===r?void 0:r.playerInstance.getItems().length} but mediaItems.length = ${He(this,Se,"f").length}`),void 0!==He(this,Le,"f")&&(He(this,Ce,"f").debug(`setMediaItems: playing item  ${He(this,Le,"f")} at pos: ${this.selectedItemPosition}`),yield this.playCurrentItem())}else He(this,Ce,"f").debug("setMediaItems: no heroVMPlayer set")}))}getMediaItems(){const e=[];return He(this,Se,"f").forEach((t=>{e.push(Object.assign({},t))})),e}selectItem(e,t,i){return je(this,void 0,void 0,(function*(){if(!e)return He(this,Ce,"f").info("item null, clearing selection"),Ye(this,Le,null,"f"),void(this.enableEvents&&He(this,_e,"f").dispatchEvent(new CustomEvent(We.SelectedItemChanged,{detail:{item:He(this,Le,"f"),position:-1,extras:null}})));const t=He(this,Se,"f").find((t=>t.id===e.id));if(!t)return void He(this,Ce,"f").info(`item ${e.id} not in list, cannot be selected.  Selection remains unchanged`);if(He(this,Le,"f")&&He(this,Le,"f").id===e.id)return void He(this,Ce,"f").info(`item ${e.id} already selected, no-op`);let n,s,r;Ye(this,Le,t,"f"),He(this,Ce,"f").debug(`item selected: ${He(this,Le,"f").id} titie: ${He(this,Le,"f").title}`);const a=this.selectedItemPosition;if(He(this,Ve,"f")==qe.Circular){He(this,Ce,"f").debug(`selectItem: Behavior type is ${He(this,Ve,"f")} circularListLength: ${this.circularListLength}`);const e=this.selectedItemPosition;if(e>this.circularListLength-1)n=He(this,Se,"f").slice(0,this.circularListLength),r=He(this,Se,"f").slice(this.circularListLength);else if(e<=this.circularListLength-1){e==this.circularListLength-1&&He(this,Ce,"f").debug("selectedItem is at end, repositioning to head"),n=He(this,Se,"f").slice(e,this.circularListLength),s=He(this,Se,"f").slice(0,e);const t=n.concat(s),i=He(this,Se,"f").slice(t.length);Ye(this,Se,t.concat(i),"f"),He(this,Ce,"f").debug("selectItem: new mediaItems list: "),He(this,Se,"f").forEach((e=>{He(this,Ce,"f").debug(` ${e.id}`)}))}}else{if(He(this,Ve,"f")!=qe.Linear)throw Error(`selectItem: Behavior type ${He(this,Ve,"f")} not yet supported`);He(this,Ce,"f").debug(`selectItem: Behavior type is ${He(this,Ve,"f")}`)}this.enableEvents&&He(this,_e,"f").dispatchEvent(new CustomEvent(We.SelectedItemChanged,{detail:{item:He(this,Le,"f"),position:this.selectedItemPosition,extras:i}})),He(this,Ve,"f")==qe.Circular&&this.selectedItemPosition<=this.circularListLength-1&&this.enableEvents&&He(this,_e,"f").dispatchEvent(new CustomEvent(We.MediaItemsChanged,{detail:{changeType:"order",origSelectedItemPos:a,items:this.getMediaItems()}})),this.heroVMPlayer?(He(this,Ce,"f").debug(`selectItem: about to play ${this.selectedItem.title}`),yield this.playCurrentItem(),He(this,Ce,"f").debug(`selectItem: playing ${this.selectedItem.title}`)):He(this,Ce,"f").debug(`selectItem: no #heroVMPlayer, not playing ${this.selectedItem.title}`)}))}get selectedItem(){return He(this,Le,"f")||void 0}get selectedItemPosition(){return He(this,Le,"f")?He(this,Se,"f").indexOf(He(this,Le,"f")):-1}playCurrentItem(){return je(this,void 0,void 0,(function*(){if(He(this,$e,"f"))if(He(this,$e,"f").isRendered)if(He(this,$e,"f").playerInstance){let e=this.selectedItemPosition;He(this,Ce,"f").debug(`playCurrentItem: selectedItem id: ${this.selectedItem.id} title: ${this.selectedItem.title} curPos: ${e}`),He(this,Ve,"f")===qe.Circular&&e==He(this,Se,"f").length-1&&(e=0);const t=this.selectedItem.id,i=He(this,$e,"f").playerInstance.getItems().findIndex((e=>e.id===t));if(i<0)He(this,Ce,"f").error(`playCurrentItem: uuid: ${t} not found in VMPlayer playlist`);else{try{He(this,Ce,"f").debug(`playCurrentItem: setPlaylistPosition to ${i}`),yield He(this,$e,"f").playerInstance.setPlaylistPosition(i);const e=He(this,$e,"f").playerInstance.getCurrentItem();He(this,Ce,"f").debug(`playCurrentItem: current item is now ${e.title}`)}catch(e){He(this,Ce,"f").error(`setPlaylistPosition failed, ${e}`)}He(this,$e,"f").getBehavior().userRequestPlay()}}else He(this,Ce,"f").error("playCurrentItem: no EVPlayer!");else He(this,Ce,"f").error("playCurrentItem:  VMPlayer EVPlayer not rendered!");else He(this,Ce,"f").error("playCurrentItem: no VMPlayer!")}))}playNextItem(){return je(this,void 0,void 0,(function*(){if(He(this,$e,"f"))try{if(He(this,Ve,"f")==qe.Circular){const e=He(this,$e,"f").playerInstance.getCurrentItem();let t=He(this,$e,"f").playerInstance.getItems().findIndex((t=>t.id===e.id));if(t>=this.circularListLength-1)return t++,t>He(this,Se,"f").length-1?(He(this,Ce,"f").debug("playNextItem: reached end of list"),void(yield this.selectItem(He(this,Se,"f")[0]))):(yield He(this,$e,"f").playerInstance.setPlaylistPosition(t),void He(this,$e,"f").getBehavior().userRequestPlay())}let e=this.selectedItemPosition;if(e==He(this,Se,"f").length-1){if(He(this,Ve,"f")==qe.Linear)return;e=0}else e+=1;yield this.selectItem(He(this,Se,"f")[e])}catch(e){He(this,Ce,"f").error("playNextItem: no item to play!")}}))}get enableEvents(){return He(this,ke,"f")}set enableEvents(e){He(this,Ce,"f").debug("enableEvents",e?"enable":"disable"),Ye(this,ke,e,"f"),e?He(this,Te,"m",De).call(this):He(this,Te,"m",Ne).call(this)}addMediaItem(e,t=0){var i;return je(this,void 0,void 0,(function*(){let n=-1;if(!e)return He(this,Ce,"f").debug("addMediaItem: no mediaItem provided"),n;if(!e.id)return He(this,Ce,"f").debug("addMediaItem: mediaItem malformed"),n;n=t<0?0:t>He(this,Se,"f").length?He(this,Se,"f").length:t;const s=He(this,$e,"f").playerInstance;let r=s.getItems().findIndex((({id:t})=>t===(null==e?void 0:e.id)));if(r<0)try{r=yield s.addPlaylistItem(e)}catch(e){}if(r<0)return-1;const a=He(this,Se,"f").findIndex((({id:t})=>t===(null==e?void 0:e.id)));return a>=0&&a<He(this,Se,"f").length&&He(this,Se,"f").splice(a,1),He(this,Se,"f").splice(n,0,e),this.enableEvents&&n!=n&&He(this,_e,"f").dispatchEvent(new CustomEvent(We.MediaItemsChanged,{detail:{changeType:"order",origSelectedItemPos:this.selectedItemPosition,items:[...He(this,Se,"f")]}})),He(this,Ce,"f").debug("addMediaItem: id: "+(null===(i=null==e?void 0:e.id)||void 0===i?void 0:i.substring(0,12))+", vpPosition: "+r+", pmPosition: "+n),n}))}addMediaItems(e,t=0){return je(this,void 0,void 0,(function*(){const i=[];if(!(e instanceof Array))return He(this,Ce,"f").debug("addMediaItems: the provided mediaItems list is not an array."),i;if(e.length<=0)return He(this,Ce,"f").debug("addMediaItems: the provided mediaItems list is empty."),i;const n=[...e];for(let e=0;e<n.length;e++){const t=He(this,Se,"f").findIndex((({id:t})=>{var i;return t===(null===(i=n[e])||void 0===i?void 0:i.id)}));t>=0&&He(this,Se,"f").splice(t,1)}for(let e=0;e<n.length;e++)t=yield this.addMediaItem(n[e],t),i.push(t),t++;return He(this,Ce,"f").debug("addMediaItems: addedMediaItems",i),i}))}removeMediaItem(e){var t,i;return je(this,void 0,void 0,(function*(){let n=null;if("string"!=typeof e)return He(this,Ce,"f").debug("removeMediaItem: mediaItemId is not a string"),n;const s=null===(t=He(this,$e,"f"))||void 0===t?void 0:t.playerInstance,r=s.getItems().findIndex((({id:t})=>t===e)),a=this.getMediaItems().findIndex((({id:t})=>t===e));if(r===s.getPlaylistPosition())return He(this,Ce,"f").debug("removeMediaItem: requested item is currently playing"),n;if(r<0||a<0)return r<0&&He(this,Ce,"f").debug("removeMediaItem: requested item missing in VideoPlayer"),a<0&&He(this,Ce,"f").debug("removeMediaItem: requested item missing in PlaylistManager"),n;let o=null;try{o=yield s.removePlaylistItem(r)}catch(e){}return o&&(n=He(this,Se,"f").splice(a,1)[0],this.enableEvents&&He(this,_e,"f").dispatchEvent(new CustomEvent(We.MediaItemsChanged,{detail:{changeType:"order",origSelectedItemPos:this.selectedItemPosition,items:[...He(this,Se,"f")]}}))),He(this,Ce,"f").debug("removeMediaItem: id: "+(null===(i=null==n?void 0:n.id)||void 0===i?void 0:i.substring(0,12))+", vpPosition: "+r+", pmPosition: "+a),n}))}removeMediaItems(e){return je(this,void 0,void 0,(function*(){const t=[];if(!(e instanceof Array))return He(this,Ce,"f").debug("removeMediaItems: the provided mediaItems list is not an array."),t;if(e.length<=0)return He(this,Ce,"f").debug("removeMediaItems: the provided mediaItems list is empty."),t;for(const i of e){const e=yield this.removeMediaItem(i);e&&t.push(e)}return He(this,Ce,"f").debug("removeMediaItems: removedMediaItems",t),t}))}},Ee.PlaylistBehavior=qe,Ee.PlaylistEvents=We,["YAHOO","OATH"].forEach((e=>{var t,i,n;(null===(i=null===(t=null===window||void 0===window?void 0:window[e])||void 0===t?void 0:t.VideoPlatform)||void 0===i?void 0:i.VideoManager)||(window[e]=(null===window||void 0===window?void 0:window[e])||{},window[e].VideoPlatform=(null===(n=null===window||void 0===window?void 0:window[e])||void 0===n?void 0:n.VideoPlatform)||{},window[e].VideoPlatform.VideoManager=Ee,window[e].VideoPlatform.VideoManager.SegmentList=tt,window[e].VideoPlatform.VideoManager.SegmentListEvents=Xe,window[e].VideoPlatform.VideoManager.SegmentSyncer=ht,window[e].VideoPlatform.VideoManager.VideoSegment=Me,Ee.logger.info("LOADER exposed "+Ee.version+" @ window."+e+".VideoPlatform.VideoManager"))})))})();